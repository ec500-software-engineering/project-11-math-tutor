<html>
<head>
    <link rel = "stylesheet" type = "text/css" href = "/styles/style">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
<style>
    body {
      font-family: Arial, Helvetica, sans-serif;
      background-color: #D3D3D3;
    }
    form {border: 3px solid #4CAF50;}
    button {

    }

    .container {
      margin: auto;
      width: 60%;
      padding: 1px;
    }

    h1.class_one{
      color: #4CAF50;
    }

</style>
</head>
<body>
  <div class="row">
    <div class="col-5" id = "username"></div>
    <div class="col-6"><h1 class="class_one" >Homepage</h1></div>
    <div class="col-1"><button onclick = "logout()" type="button" class="btn btn-danger">logout</button></div>
  </div>

    <br>
    <br>
    <h1>Your Classes</h1>

    <div id = "classes"></div>
    <input type="text" placeholder="New Class Name" id="className" required>
    <button onclick = "addClass()" id="add-class" class="btn btn-success">Add Class</button>



  <!-- Firebase App (the core Firebase SDK) is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/5.10.0/firebase-app.js"></script>

<!-- Add Firebase products that you want to use -->
<script src="https://www.gstatic.com/firebasejs/5.10.0/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/5.10.0/firebase-database.js"></script>

<script>

    var config = {
    apiKey: "AIzaSyCg_6hjpweEXjwnEpVrUbIhfjAfCikgUAc",
    authDomain: "mathpath-c0a60.firebaseapp.com",
    databaseURL: "https://mathpath-c0a60.firebaseio.com",
    projectId: "mathpath-c0a60",
    storageBucket: "mathpath-c0a60.appspot.com",
    messagingSenderId: "448979947802"
  };
  firebase.initializeApp(config);
  var database = firebase.database();

window.onload = function()
{
    setTimeout(function() { getUserData(); }, 500);
};

firebase.auth().onAuthStateChanged(function(user) {
    console.log("here");
  if (user) {
    // User is signed in.
    console.log("login");
    // ...
  } else {
    // User is signed out.
    // ...
    window.location.pathname = '/';
    console.log("logout");
  }
});

function getUserData()
{
    var userId = firebase.auth().currentUser.uid;
    var userName = firebase.auth().currentUser.email;
    document.getElementById("username").innerHTML = "<p>"+"welcome: " + userName+"</p>"

    var root = database.ref('classes/'+userId);
    root.on('value',function(snap)
        {
            data = snap.val()
            if(data!=null)
            {
                pageTable = ""
                for(var page in data)
                {
                    pageTable+="<a href = /class?author="+userId+"&page=" +page+ ">"
                    pageTable+=page
                    pageTable+="</a>"
                    pageTable+="<br>"
                }
            }
            console.log(snap.val())
            document.getElementById("classes").innerHTML = pageTable
        });
    console.log("getting user data");
}

function postData(page,post)
{
    var userId = firebase.auth().currentUser.uid;
    var root = database.ref('classes/' + userId+"/"+page);
    root.set(
        {
            post
        });
}

function logout()
{
    firebase.auth().signOut().then(function() {
    // Sign-out successful.
    }, function(error) {
    // An error happened.
    });
    window.location.pathname = '/';
}

function addClass()
{
    console.log("here")
    var page= document.getElementById("className").value
    postData(page,"")

}



</script>
</body>
</html>
